<!doctype html>
<html lang="en">

<head>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ashwin Vaidya's Blog | Self Driving Car using Genetic Algorithm in Unity Engine</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Self Driving Car using Genetic Algorithm in Unity Engine">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.ashwinvaidya.com/blog/posts/self-driving-car-using-genetic-algorithm-in-unity">
  <meta property="og:description" content="">
  <meta property="og:site_name" content="Ashwin Vaidya's Blog">
  <meta property="og:image" content="https://www.ashwinvaidya.com/blog/blog/assets/og-image.jpg">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://www.ashwinvaidya.com/blog/posts/self-driving-car-using-genetic-algorithm-in-unity">
  <meta name="twitter:title" content="Self Driving Car using Genetic Algorithm in Unity Engine">
  <meta name="twitter:description" content="">
  <meta name="twitter:image" content="https://www.ashwinvaidya.com/blog/blog/assets/og-image.jpg">

  <link rel="apple-touch-icon" href="/blog/assets/apple-touch-icon.png">
  <link href="https://www.ashwinvaidya.com/blog/feed.xml" type="application/rss+xml" rel="alternate" title="Ashwin Vaidya's Blog Last 10 blog posts" />

  

  
    <link rel="stylesheet" href="/blog/assets/dark.css">

  
</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav appear">
  <a href="/blog/" class="header-logo" title="Ashwin Vaidya's Blog">Ashwin Vaidya's Blog</a>
  <ul class="header-links">
    
    
      <li>
        <a href="https://twitter.com/ashwinvaidya17" rel="noreferrer noopener" target="_blank" title="Twitter">
          <span class="icon icon-twitter"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/ashwinvaidya17" rel="noreferrer noopener" target="_blank" title="GitHub">
          <span class="icon icon-github"></span>
        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/ashwinvaidya17" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <span class="icon icon-linkedin"></span>
        </a>
      </li>
    
    
    
    
      <li>
        <a href="/blog/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <span class="icon icon-rss"></span>
        </a>
      </li>
    
  </ul>
</nav>

        <article class="article appear">
          <header class="article-header">
            <h1>Self Driving Car using Genetic Algorithm in Unity Engine</h1>
            <p></p>
            <div class="article-list-footer">
              <span class="article-list-date">
                August 21, 2018
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  4 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/blog/tag/ml">ml</a>
                
                  <a href="/blog/tag/neural network">neural network</a>
                
                  <a href="/blog/tag/genetic algorithm">genetic algorithm</a>
                
                  <a href="/blog/tag/unity">unity</a>
                
                  <a href="/blog/tag/unity3d">unity3d</a>
                
                  <a href="/blog/tag/game">game</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <p>I created a self-driving car in Unity engine using genetic algorithm. You can see the results:
<img src="../assets/img/SDCUgame.gif" alt="" />
<img src="../assets/img/SDCUscene.gif" alt="" /></p>

<p>I took up this project after being inspired by these videos:</p>

<p><a href="http://www.youtube.com/watch?v=ZX2Hyu5WoFg"><img src="http://img.youtube.com/vi/ZX2Hyu5WoFg/0.jpg" alt="" /></a></p>

<p><a href="http://www.youtube.com/watch?v=8V2sX9BhAW8"><img src="http://img.youtube.com/vi/8V2sX9BhAW8/0.jpg" alt="" /></a></p>

<h2 id="making-the-neural-network">Making the Neural Network</h2>

<p>To implement this the first step was to learn what a neural network is and how does it work.</p>

<p>After spending a lot of time on youtube and kaggle, I got a fair idea of what a neural network is. I think the best tutorial of a neural network similar to the one used in the project is <a href="http://neuralnetworksanddeeplearning.com/chap1.html">here</a>. Even if you are not familiar with neural networks, I’ll give you a quick intro needed for this project.</p>

<p>Basically, a neuron is modelled something like this:</p>

<p><img src="../assets/img/artificial_neuron.jpg" alt="" /></p>

<p>Here, inputs to a neuron are multiplied by weights and added. This then is passed to an activation function. The aim of the activation function is to rescale the result from the previous step. The activation function used in the code is tanh function. It maps the input into the range of -1 to +1. But, before the sum of the weights multiplied by the inputs is passed through the activation function, a bias is added to it. For more on why bias is added, <a href="https://www.quora.com/What-is-bias-in-artificial-neural-network">here</a> is a good resource.  I chose tanh function as the inputs to the move function of the car take value between -1 and 1 for both, the steering and the acceleration.</p>

<p>Now, I will explain the architecture of the neural network used in this project.</p>

<p>For the input layer, I decided to take the speed, distance in front, distance at 45 degrees to the left and the distance at 45 degrees to the right.</p>

<p><img src="../assets/img/car_initial.jpg" alt="" /></p>

<p>The took the speed as the car used in the project was provided with the standard assets of Unity. When the move function is called, it keeps increasing the speed till it reaches the max speed. This change is speed could affect the decision taken when approaching a turn.</p>

<p>For the hidden layer, I thought 5 neurons would do the job. This was more of an arbitrary choice. I didn’t tweak this layer to see whether it affects the performance.</p>

<p>The output layer was a pretty easy decision. I needed the network to predict the direction to turn and whether to accelerate. Since, the outputs were two, I chose two neurons for the output.</p>

<p>However, when I started training, I quickly realized two major issues. Since the distance to the immediate left and immediate right was not provided, the car tended to go very close to the wall during the turns. Further, since the network was not trained, the acceleration output tended to make the car oscillate at the place or it didn’t move at all.</p>

<p>To tackle the first issue, I modified the network to take the left and right distances also as the inputs. It now became something like this:</p>

<p><img src="../assets/img/car_final.jpg" alt="" /></p>

<p>Even though the acceleration output could have been trained. I decided that for this version, I will not use the neural network to predict the acceleration.</p>

<p>The final network looked like this:</p>

<p><img src="../assets/img/SDC_nn.jpg" alt="" /></p>

<h2 id="training">Training</h2>

<p>The neural network described above was initialized with random weights and biases. At this current state, it was not enough to make the car drive itself. To make it drive, I needed to train the network. Training is basically changing the weights so that the predicted output conforms to the task required. There are various methods to train the network. Being inspired from the first two videos, I choose to use genetic algorithm.</p>

<p>In order to learn how a genetic algorithm works and how to implement it, I came across this video.</p>

<p><a href="http://www.youtube.com/watch?v=9zfeTw-uFCw"><img src="http://img.youtube.com/vi/9zfeTw-uFCw/0.jpg" alt="" /></a></p>

<p>I adapted the code to python. You can see it <a href="https://github.com/ashwinvaidya17/GeneticAlgorithm-Strings">here</a>. This gave me some confidence to tackle the project.</p>

<p>Here is a quick recap of how a genetic algorithm works:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1. Initialize a population
2. Find the fittest children of the population.
3. Crossover the fittest children.
4. Mutate the new population
5. If the fitness criteria is not met, go to step 2
</code></pre>
</div>

<p>With this in mind, I started with the population size of 10 children, each with randomly initialized weights. I attached each network one by one to the car and stored the furthest distance and the second furthest distance travelled. These two networks were then selected as the parents of the next population. Each time the car collided with the wall, the child is killed.</p>

<p>I took the weights and biases of both the parents and alternately assigned to each child. While assigning, I mutated it with 5% mutation rate.</p>

<p>Finally, at ~60th generation that car learnt to drive itself.</p>

<p>Thanks for reading. If you like this post. Please leave a comment with feedback, suggestion and criticisms. They help me to improve.</p>

          </div>

          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Self+Driving+Car+using+Genetic+Algorithm+in+Unity+Engine - https://www.ashwinvaidya.com/blog/posts/self-driving-car-using-genetic-algorithm-in-unity by @ashwinvaidya17" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.ashwinvaidya.com/blog/posts/self-driving-car-using-genetic-algorithm-in-unity" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
            <a href="https://plus.google.com/share?url=https://www.ashwinvaidya.com/blog/posts/self-driving-car-using-genetic-algorithm-in-unity" title="Share on Google+" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 128 128"><path d="M40.7 55.9v16.1c0 0 15.6 0 22 0C59.2 82.5 53.8 88.2 40.7 88.2c-13.3 0-23.7-10.8-23.7-24.2s10.4-24.2 23.7-24.2c7.1 0 11.6 2.5 15.8 5.9 3.3-3.3 3.1-3.8 11.6-11.9 -7.2-6.6-16.8-10.6-27.4-10.6C18.2 23.3 0 41.5 0 64c0 22.5 18.2 40.7 40.7 40.7 33.6 0 41.8-29.3 39-48.8H40.7zM113.9 56.7V42.6h-10.1v14.1H89.4v10.1h14.5v14.5h10.1V66.8H128V56.7H113.9z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://ashwinvaidya.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer appear">
  <p>
    Chalk is a high quality, completely customizable, performant and 100% free
    blog template for Jekyll built by
    <a href="/blog/about" title="About me">Nielsen Ramon</a>. Download it <a href="https://github.com/nielsenramon/chalk" rel="noreferrer noopener" target="_blank" title="Download Chalk">here</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-123420588-1','auto');ga('send','pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async></script>


<script src="/blog/assets/vendor.js"></script>



  <script src="/blog/assets/webfonts.js"></script>




  <script src="/blog/assets/scrollappear.js"></script>



<script src="/blog/assets/application.js"></script>


</body>
</html>
